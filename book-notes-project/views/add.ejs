<!doctype html>
<html lang="1">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:ital,wght@0,100..900;1,100..900&family=Noto+Serif:ital,wght@0,100..900;1,100..900&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:ital,wght@0,100..900;1,100..900&display=swap" rel="stylesheet">
    <link rel="icon" type="image/png" href="/images/favicon-96x96.png" sizes="96x96" />
    <link rel="icon" type="image/svg+xml" href="/images/favicon.svg" />
    <link rel="shortcut icon" href="/images/favicon.ico" />
    <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png" />
    <meta name="apple-mobile-web-app-title" content="MyWebSite" />
    <link rel="manifest" href="/images/site.webmanifest" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" integrity="sha512-SnH5WK+bZxgPHs44uWIX+LLJAJ9/2PkPKZ5QiAj6Ta86w+fsb2TkcmfRyVX3pBnMFcV7oQPJkl9QevSCWr3W6A==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <link rel="stylesheet" href="/styles/main.css">
    <script src="/styles/script.js" defer></script>
    <title>Add your book</title>
</head>
<body>
<%- include("./partials/header.ejs") %>
<main class="main-add-edit">
    <!--    Validation error helper-->
    <% function getError(field) {
        if (!locals.error) return null;
        const err = locals.error.details.find(e => e.path === field);
        return err ? err.msg : null;
    } %>
    <form action="/submit" method="post">
        <h2 class="add-edit-heading">Please add a new book</h2>
        <input type="text" name="title" placeholder="Title" value="<%= locals.formData?.title || "" %>" autocomplete="off">
        <p class="form-error"><%= getError('title') %></p>
        <input type="text" name="author" placeholder="Author" value="<%= locals.formData?.author || "" %>" autocomplete="off">
        <p class="form-error"><%= getError('author') %></p>
        <input type="text" name="isbn" placeholder="ISBN" value="<%= locals.formData?.isbn || "" %>" autocomplete="off">
        <p class="form-error"><%= getError('isbn') %></p>
        <input type="text" name="reader_name" placeholder="Your name" value="<%= locals.formData?.reader_name || "" %>" autocomplete="off">
        <p class="form-error"><%= getError('reader_name') %></p>
        <label for="date" id="form-date-read">Date read:</label>
        <input type="date" id="date" name="date" value="<%= locals.formData?.date || "" %>" autocomplete="off">
        <p class="form-error"><%= getError('date') %></p>
        <textarea name="review" rows="10" autocomplete="off" placeholder="Please leave a review"><%= locals.formData?.review || "" %></textarea>
        <p class="form-error"><%= getError('review') %></p>
        <label for="select">Please leave a rating</label>
        <div class="ranking-container">
            <% for (let i = 1; i <= 5; i++) {
                const currentRate = locals.formData?.rate ?? 0; // fallback to 0 for new books
            %>
            <label for="rate-<%= i %>">
                <i class="star-ranking fa-solid fa-star <%= i <= currentRate ? 'active' : '' %>"></i>
            </label>
            <input
                    type="radio"
                    id="rate-<%= i %>"
                    name="rate"
                    value="<%= i %>"
                    hidden
                    <%= i == currentRate ? 'checked' : '' %>
            >
            <% } %>
        </div>
        <p class="form-error"><%= getError('rate') %></p>
        <button type="submit">Submit</button>
    </form>
</main>
<%- include("./partials/footer.ejs") %>
</body>
</html>